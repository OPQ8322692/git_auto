{"name": "1.0请求获取reorderToken1", "status": "broken", "statusDetails": {"message": "pymysql.err.OperationalError: (1065, 'Query was empty')", "trace": "self = <data.test_excel_case.TestExcel object at 0x03BF2790>\ncase = {'cookies': '', 'headers': '', 'status_code': 200.0, '前置条件': '', ...}\nget_token = {'hotline_id': '3402033689_0', 'wsf_user_token': 'bd753b9f-cc5c-4a2b-929b-b10d71bfa093'}\n\n    @pytest.mark.parametrize(\"case\",run_list)\n    def test_run(self,case,get_token):\n        #data_key = ExcelConfig.DataConfig()\n        url = case[data_key.url]\n        case_id = case[data_key.case_id]\n        case_model = case[data_key.case_model]\n        case_name = case[data_key.case_name]\n        pre_exc = case[data_key.pre_exc]\n        method = case[data_key.method]\n        params_type = case[data_key.params_type]\n        params = case[data_key.params]\n        except_result = case[data_key.except_result]\n        actual_result = case[data_key.actual_result]\n        is_run = case[data_key.is_run]\n        headers = case[data_key.headers]\n        cookies = case[data_key.cookies]\n        code = case[data_key.code]\n        db_result = case[data_key.db_result]\n        #print(url)\n        #print(case_model)\n    \n        #1.判断headers是否存在，存在json转义，无需\n        # if headers:\n        #     header = json.load(headers)\n        # else:\n        #     header = headers\n        # #2、增加cookies\n        # if cookies:\n        #     cookie = json.loads(cookies)\n        # else:\n        #     cookie = cookies\n        #header = Base.json_parse(headers)\n        #cookie = Base.josn_parse(cookies)\n    \n        #1、验证前置条件\n        if pre_exc:\n            pass\n        #2、找到执行用例\n            #前置测试用例\n            pre_case = data_init.get_case_pre(pre_exc)\n            print(\"前置条件信息为：%s\"%pre_exc)\n            print(\"前置用例为：%s\"%pre_case)\n            pre_res = self.run_pre(pre_case,get_token)\n            print(\"执行前置用例结果为：%s\"%pre_res)\n            #print(\"执行前置用例body结果为：%s\"%pre_res[\"body\"][\"data\"][\"reOrderToken\"])\n            #替换\n            #params = Base.json_parse(params)\n            #print(\"将json中的null转换为字典格式：%s\"%params)\n            # 注意需要转换成字符串传参\n            #print(\"格式化字典参数是：\\\"%s\\\"\"%params)\n            #params1 = '\"'+str(params)+'\"'\n            #params = '\"{}\"'.format(str(params))\n            print(params)\n            headers,cookies,params = self.get_correlation(headers,cookies,params,pre_res)\n            #paramend = json.loads(params3)\n            print(\"替换后的参数是：%s\"%params)\n        # headers = Base.json_parse(headers)\n        # cookies = Base.json_parse(cookies)\n        # params = Base.json_parse(params)\n        # print(\"字典化参数为：%s\"%params)\n        #执行正常的测试用例\n        res = self.run_api(url=url,get_token=get_token,method=method,params_type=params_type,params=params,header=headers,cookies=get_token)\n        print(res)\n    \n        #allure\n        #sheet名称 feature一级标签\n        allure.dynamic.feature(sheet_name)\n        #模块 story 二级标签\n        allure.dynamic.story(case_name)\n        #用例ID+接口名称 title\n        allure.dynamic.title(case_id+case_name)\n        #请求URL 请求类型 期望结果 实际结果 描述\n        desc  = \"请求URL:{},请求类型：{}，期望结果：{}，实际结果：{}\".format(url,method,except_result,res)\n        allure.dynamic.description(desc)\n    \n        #断言验证\n        #状态码，返回结果内容，数据库相关的结果的验证\n        #状态码\n        assert_util = AssertUtil()\n        assert_util.assert_code(int(res[\"code\"]),int(code))\n        #验证结果内容，包含，注意表格中要用单引号，因为返回的结果是字典类型\n        assert_util.assert_in_body(str(res[\"body\"]),str(except_result))\n        #数据库结果断言,应该要用if先判断表格是否有值 再执行\n        #初始化数据库\n        from common.Base import init_db\n        sql = init_db(\"db_pre\")\n        #查询sqp语句，excel定义好的\n>       db_res = sql.fetchone(db_result)\n\ntest_excel_case.py:221: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n..\\utils\\MysqlUtil.py:24: in fetchone\n    self.cursor.execute(sql)\nC:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python36-32\\lib\\site-packages\\pymysql\\cursors.py:148: in execute\n    result = self._query(query)\nC:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python36-32\\lib\\site-packages\\pymysql\\cursors.py:310: in _query\n    conn.query(q)\nC:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python36-32\\lib\\site-packages\\pymysql\\connections.py:548: in query\n    self._affected_rows = self._read_query_result(unbuffered=unbuffered)\nC:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python36-32\\lib\\site-packages\\pymysql\\connections.py:775: in _read_query_result\n    result.read()\nC:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python36-32\\lib\\site-packages\\pymysql\\connections.py:1156: in read\n    first_packet = self.connection._read_packet()\nC:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python36-32\\lib\\site-packages\\pymysql\\connections.py:725: in _read_packet\n    packet.raise_for_error()\nC:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python36-32\\lib\\site-packages\\pymysql\\protocol.py:221: in raise_for_error\n    err.raise_mysql_exception(self._data)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\ndata = b'\\xff)\\x04#42000Query was empty'\n\n    def raise_mysql_exception(data):\n        errno = struct.unpack(\"<h\", data[1:3])[0]\n        errval = data[9:].decode(\"utf-8\", \"replace\")\n        errorclass = error_map.get(errno)\n        if errorclass is None:\n            errorclass = InternalError if errno < 1000 else OperationalError\n>       raise errorclass(errno, errval)\nE       pymysql.err.OperationalError: (1065, 'Query was empty')\n\nC:\\Users\\Administrator\\AppData\\Local\\Programs\\Python\\Python36-32\\lib\\site-packages\\pymysql\\err.py:143: OperationalError"}, "description": "请求URL:https://test-user-site-api.wanshifu.com/order/publish/info,请求类型：POST，期望结果：，实际结果：{'code': 200, 'body': {'code': 'success', 'data': {'autoAppointRuleId': 0, 'autoAppointRuleName': '', 'hasWaitAuditSettlementChange': False, 'innovative': {'lastOrderInfo': None, 'orderRecordExists': {'customized': True, 'renovation': True}}, 'isFirstOrder': '0', 'lastOrderType': 'order', 'orderInfo': None, 'orderUserCount': '406874', 'reOrderToken': '9e29a1142b1342bd9b8cfd0c4268714a', 'serveMenuInfo': {'lastCategoryId': 1, 'lastServeType': 4, 'selectCategoryId': 1, 'selectServeType': 4, 'serveCategoryInfoList': [{'categoryId': 1, 'serveTypeInfoList': [{'serveType': 1, 'serveTypeId': 1, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 2, 'serveTypeId': 2, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 3, 'serveTypeId': 3, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 4, 'serveTypeId': 4, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 5, 'serveTypeId': 5, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 6, 'serveTypeId': 6, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 7, 'serveTypeId': 7, 'supportDefinitePrice': False, 'supportOfferPrice': True}], 'serverTypeIdList': [1, 2, 3, 4, 5, 6, 7]}, {'categoryId': 2, 'serveTypeInfoList': [{'serveType': 4, 'serveTypeId': 10, 'supportDefinitePrice': True, 'supportOfferPrice': True}, {'serveType': 5, 'serveTypeId': 11, 'supportDefinitePrice': False, 'supportOfferPrice': True}], 'serverTypeIdList': [10, 11]}, {'categoryId': 4, 'serveTypeInfoList': [{'serveType': 4, 'serveTypeId': 15, 'supportDefinitePrice': True, 'supportOfferPrice': True}, {'serveType': 9, 'serveTypeId': 49, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 5, 'serveTypeId': 16, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 2, 'serveTypeId': 13, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 3, 'serveTypeId': 14, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 6, 'serveTypeId': 18, 'supportDefinitePrice': False, 'supportOfferPrice': True}], 'serverTypeIdList': [15, 49, 16, 13, 14, 18]}, {'categoryId': 6, 'serveTypeInfoList': [{'serveType': 4, 'serveTypeId': 50, 'supportDefinitePrice': True, 'supportOfferPrice': True}, {'serveType': 9, 'serveTypeId': 51, 'supportDefinitePrice': True, 'supportOfferPrice': True}], 'serverTypeIdList': [50, 51]}, {'categoryId': 7, 'serveTypeInfoList': [{'serveType': 4, 'serveTypeId': 52, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 9, 'serveTypeId': 53, 'supportDefinitePrice': True, 'supportOfferPrice': False}], 'serverTypeIdList': [52, 53]}, {'categoryId': 8, 'serveTypeInfoList': [{'serveType': 4, 'serveTypeId': 21, 'supportDefinitePrice': False, 'supportOfferPrice': True}], 'serverTypeIdList': [21]}, {'categoryId': 9, 'serveTypeInfoList': [{'serveType': 4, 'serveTypeId': 24, 'supportDefinitePrice': False, 'supportOfferPrice': True}], 'serverTypeIdList': [24]}, {'categoryId': 10, 'serveTypeInfoList': [{'serveType': 2, 'serveTypeId': 25, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 3, 'serveTypeId': 26, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 4, 'serveTypeId': 27, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 6, 'serveTypeId': 28, 'supportDefinitePrice': False, 'supportOfferPrice': True}], 'serverTypeIdList': [25, 26, 27, 28]}, {'categoryId': 12, 'serveTypeInfoList': [{'serveType': 4, 'serveTypeId': 31, 'supportDefinitePrice': True, 'supportOfferPrice': True}, {'serveType': 5, 'serveTypeId': 32, 'supportDefinitePrice': False, 'supportOfferPrice': True}], 'serverTypeIdList': [31, 32]}, {'categoryId': 13, 'serveTypeInfoList': [{'serveType': 4, 'serveTypeId': 33, 'supportDefinitePrice': True, 'supportOfferPrice': True}, {'serveType': 5, 'serveTypeId': 34, 'supportDefinitePrice': False, 'supportOfferPrice': True}], 'serverTypeIdList': [33, 34]}, {'categoryId': 14, 'serveTypeInfoList': [{'serveType': 2, 'serveTypeId': 35, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 3, 'serveTypeId': 36, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 4, 'serveTypeId': 37, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 6, 'serveTypeId': 38, 'supportDefinitePrice': False, 'supportOfferPrice': True}], 'serverTypeIdList': [35, 36, 37, 38]}, {'categoryId': 15, 'serveTypeInfoList': [{'serveType': 4, 'serveTypeId': 39, 'supportDefinitePrice': True, 'supportOfferPrice': True}, {'serveType': 5, 'serveTypeId': 40, 'supportDefinitePrice': False, 'supportOfferPrice': True}], 'serverTypeIdList': [39, 40]}, {'categoryId': 17, 'serveTypeInfoList': [{'serveType': 4, 'serveTypeId': 45, 'supportDefinitePrice': True, 'supportOfferPrice': True}, {'serveType': 5, 'serveTypeId': 46, 'supportDefinitePrice': False, 'supportOfferPrice': True}], 'serverTypeIdList': [45, 46]}, {'categoryId': 18, 'serveTypeInfoList': [{'serveType': 4, 'serveTypeId': 47, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 5, 'serveTypeId': 48, 'supportDefinitePrice': False, 'supportOfferPrice': True}], 'serverTypeIdList': [47, 48]}, {'categoryId': 10001, 'serveTypeInfoList': [{'serveType': 220, 'serveTypeId': 100011000, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 224, 'serveTypeId': 100011006, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 227, 'serveTypeId': 100011012, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 231, 'serveTypeId': 100011020, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 212, 'serveTypeId': 100011026, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 235, 'serveTypeId': 100011028, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 221, 'serveTypeId': 100011002, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 226, 'serveTypeId': 100011010, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 228, 'serveTypeId': 100011014, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 232, 'serveTypeId': 100011022, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 236, 'serveTypeId': 100011030, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 223, 'serveTypeId': 100011004, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 225, 'serveTypeId': 100011008, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 229, 'serveTypeId': 100011016, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 233, 'serveTypeId': 100011024, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 237, 'serveTypeId': 100011032, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 230, 'serveTypeId': 100011018, 'supportDefinitePrice': False, 'supportOfferPrice': True}, {'serveType': 238, 'serveTypeId': 100011034, 'supportDefinitePrice': False, 'supportOfferPrice': True}], 'serverTypeIdList': [100011000, 100011006, 100011012, 100011020, 100011026, 100011028, 100011002, 100011010, 100011014, 100011022, 100011030, 100011004, 100011008, 100011016, 100011024, 100011032, 100011018, 100011034]}]}, 'toAccountInfo': None, 'userBlackInfoList': []}, 'msg': '', 'status': '1'}}", "attachments": [{"name": "log", "source": "d8c2cc61-43e9-41fd-98aa-4b1aeb8df588-attachment.txt", "type": "text/plain"}], "parameters": [{"name": "case", "value": "{'用例ID': '1.0', '模块': '发布订单', '接口名称': '请求获取reorderToken1', '请求URL': 'https://test-user-site-api.wanshifu.com/order/publish/info', '前置条件': '', '请求类型': 'POST', '请求参数类型': 'data', '请求参数': '{\"action\":\"create\"}', '预期结果': '', '实际结果': '', '是否运行': 'y', 'headers': '', 'cookies': '', 'status_code': 200.0, '数据库验证': ''}"}], "start": 1643090363787, "stop": 1643090364102, "uuid": "21d9d5f7-c926-48a1-8b70-cece8047e21d", "historyId": "258d2c0781343d8b60a549d58b3c901c", "testCaseId": "55bdc4c937df748c4c3095503da1d147", "fullName": "data.test_excel_case.TestExcel#test_run", "labels": [{"name": "feature", "value": "万师傅用户组接口用例模板"}, {"name": "story", "value": "请求获取reorderToken1"}, {"name": "parentSuite", "value": "data"}, {"name": "suite", "value": "test_excel_case"}, {"name": "subSuite", "value": "TestExcel"}, {"name": "host", "value": "test"}, {"name": "thread", "value": "279320-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "data.test_excel_case"}]}